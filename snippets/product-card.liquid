{% comment %}
    Renders a product card

    Accepts:
    - product_card_product: {Object} Product Liquid object

    Usage:
    {% render 'product-card', product_card_product: product %}
{% endcomment %}

{% liquid 
  assign split_product_title = product_card_product.title | split: "-"
%}

<div class="group/card block relative">
  <div class="group/image block relative aspect-square overflow-hidden">
    {% if product_card_product.featured_image != blank %}
      {{ product_card_product.featured_image | image_url: width: 700 | image_tag: width: product_card_product.featured_image.width, sizes: '700x', widths: '200, 300, 400, 500, 700, 900', class: 'w-full h-full object-cover realtive' }}
      {% if product_card_product.images[1] != blank %}
        {{ product_card_product.images[1] | image_url: width: 700 | image_tag: width: product_card_product.images[1].width, sizes: '700x', widths: '200, 300, 400, 500, 700, 900', class: 'w-full h-full inset object-cover opacity-0 transition-opacity group-hover/image:opacity-100' }}
      {% endif %}
    {% else %}
      <div class="w-full h-full bg-brown"> </div>
    {% endif %}

    <div class="top-half left-half -translate-x-half -translate-y-half absolute w-[calc(100%_+_30px)] h-[calc(100%_+_30px)] border-[30px] border-blue scale-[200%] group-hover/image:scale-100 transition-transform" class="absolute w-full h-full"> </div>

    <a href="{{ product_card_product.url }}"> </a>
  </div>

  <div class="mt-[22px]">
    <div class="flex flex-col justify-start items-start">
      <div class="flex flex-row justify-between items-center gap-10 w-full">
        <a href="{{ product_card_product.url }}" class="text-pangram-16 lg:text-pangram-20 leading-[30px]">
          {{ split_product_title[0] }}
        </a>
        <p class="price flex items-center gap-5 text-pangram-12 lg:text-pangram-14 whitespace-nowrap">
          {% if product_card_product.price_varies %}<span>from</span>{% endif %}
          {{ product_card_product.price | money_without_trailing_zeros }}
          {% if product_card_product.compare_at_price > product_card_product.price %}
            <span class="line-through opacity-50">{{ product_card_product.compare_at_price | money_without_trailing_zeros }}</span>
          {% endif %}
        </p>
      </div>
      {% if split_product_title[1] != blank  %}
        <a href="{{ product_card_product.url }}" class="text-arizona-18 lg:text-arizona-20">
          {{ split_product_title[1] }}
        </a>
      {% endif %}
    </div>

    <div class="mt-[22px]">
      {%- assign swatch_trigger = 'products.general.color_swatch_trigger' | t | downcase -%}
      {%- assign swatch_file_extension = 'png' -%}

      {%- for option in product_card_product.options_with_values -%}
        {%- liquid
          assign option_name = option.name | downcase
          assign is_color = false
          if option_name contains swatch_trigger
            assign is_color = true
          elsif swatch_trigger == 'color' and option_name contains 'colour'
            assign is_color = true
          endif
        -%}
        {%- if is_color -%}
          {%- assign option_index = forloop.index0 -%}
          {%- assign values = '' -%}
          <div class="flex flex-row justify-start items-center flex-wrap gap-[18px] group-[.smallView]/grid:gap-[13px]">
            {%- for variant in product_card_product.variants -%}
              {%- assign value = variant.options[option_index] %}
              {%- unless values contains value -%}
                {%- liquid
                  assign values = values | join: ',' | append: ',' | append: value | split: ','
    
                  assign color_file_name = value | handle | append: '.' | append: swatch_file_extension
                  assign color_image = color_file_name | file_img_url: '50x50' | prepend: 'https:' | split: '?' | first
                  assign color_swatch_fallback = value | split: ' ' | last | handle
                  assign color_count = color_count | plus: 1
                -%}
    
                <a
                  href="{{ variant.url | within: collection }}"
                  class="swatch group-[.smallView]/grid:w-[17px] {% if variant == product_card_product.selected_or_first_available_variant or variant.selected %}active-swatch{% endif %}"
                  aria-label="{{ product_card_product.title }} - {{ value }}"
                  style="background-color: {{ color_swatch_fallback }};{% if images[color_file_name] != blank %}  background-image: url({{ color_image }});{% endif %}">
                </a>
              {%- endunless -%}
             {%- endfor -%}
          </div>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
</div>
