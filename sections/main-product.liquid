<script src="{{ 'product.js' | asset_url }}" defer="defer"></script>

<section class="page-width">
  <div class="product mt-20 md:grid md:grid-cols-2 md:gap-20">
    <a class="skip-to-content-link button visually-hidden" href="#ProductInfo-{{ section.id }}">
      {{ "accessibility.skip_to_product_info" | t }}
    </a>

    <div>
      <ul class="product-slider list-unstyled swiper" role="list">
        <div class="swiper-wrapper">
          {% for media in product.media %}
            <li class="swiper-slide" data-media-id="{{ section.id }}-{{ media.id }}">
              {% assign sizes = '(min-width: 769px) 75vw, 100vw' %}
              {{ media | image_url: width: 1000 | image_tag: preload: true, width: media.width, sizes: sizes, widths: '300, 400, 500, 600, 700, 800, 900, 1000, 1200', class: 'w-full aspect-product object-cover' }}
            </li>
          {% endfor %}
        </div>
        <div class="product-slider-pagination swiper-pagination mt-20"></div>
      </ul>
    </div>

    <div id="ProductInfo-{{ section.id }}" class="pt-20 md:pt-30 md:pl-40">
      {% assign product_form_id = 'product-form-' | append: section.id %}

      <h1 class="mb-10 text-m-h3 font-bold md:text-h3">
        {{ product.title | escape }}
      </h1>

      <p class="price mb-30 flex items-center gap-5 text-body">
        {{ product.price | money }}
        {% if product.compare_at_price > product.price %}
          <span class="strike-through opacity-50">{{ product.compare_at_price | money }}</span>
        {% endif %}
      </p>

      {% if product.description != blank %}
        <div class="rte text-body">
          {{ product.description }}
        </div>
      {% endif %}

      {% render 'product-form' product: product, product_form_id: product_form_id %}

    </div>
  </div>

</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    function isIE() {
      const ua = window.navigator.userAgent;
      const msie = ua.indexOf('MSIE ');
      const trident = ua.indexOf('Trident/');

      return (msie > 0 || trident > 0);
    }

    if (!isIE()) return;
    const hiddenInput = document.querySelector('#{{ product_form_id }} input[name="id"]');
    const noScriptInputWrapper = document.createElement('div');
    const variantSwitcher = document.querySelector('variant-radios[data-section="{{ section.id }}"]') || document.querySelector('variant-selects[data-section="{{ section.id }}"]');
    noScriptInputWrapper.innerHTML = document.querySelector('.product-form__noscript-wrapper-{{ section.id }}').textContent;
    variantSwitcher.outerHTML = noScriptInputWrapper.outerHTML;

    document.querySelector('#Variants-{{ section.id }}').addEventListener('change', function(event) {
      hiddenInput.value = event.currentTarget.value;
    });
  });
</script>

{% liquid
  if product.selected_or_first_available_variant.featured_media
    assign seo_media = product.selected_or_first_available_variant.featured_media
  else
    assign seo_media = product.featured_media
  endif
%}

<script type="application/ld+json">
  {
    "@context": "http://schema.org/",
    "@type": "Product",
    "name": {{ product.title | json }},
    "url": {{ shop.url | append: product.url | json }},
    {% if seo_media %}
      {% assign media_size = seo_media.preview_image.width | append: 'x' %}
      "image": [
        {{ seo_media | img_url: media_size | prepend: "https:" | json }}
      ],
    {% endif %}
    "description": {{ product.description | strip_html | json }},
    {% if product.selected_or_first_available_variant.sku != blank %}
      "sku": {{ product.selected_or_first_available_variant.sku | json }},
    {% endif %}
    "brand": {
      "@type": "Thing",
      "name": {{ product.vendor | json }}
    },
    "offers": [
      {% for variant in product.variants %}
        {
          "@type" : "Offer",
          {% if variant.sku != blank %}
            "sku": {{ variant.sku | json }},
          {% endif %}
          "availability" : "http://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
          "price" : {{ variant.price | divided_by: 100.00 | json }},
          "priceCurrency" : {{ cart.currency.iso_code | json }},
          "url" : {{ shop.url | append: variant.url | json }}
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
</script>

{% schema %}
  {
    "name": "Product",
    "tag": "section",
    "class": "product-section",
    "blocks": [

    ],
    "settings": [

    ]
  }
{% endschema %}
