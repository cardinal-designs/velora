{% liquid 
  assign split_product_title = product.title | split: "-"
%}

<section class="">
  <script src="{{ 'product.js' | asset_url }}" defer="defer"></script>
  <div class="product md:grid md:grid-cols-12 md:gap-20">
    <a class="skip-to-content-link button visually-hidden" href="#ProductInfo-{{ section.id }}">
      {{ "accessibility.skip_to_product_info" | t }}
    </a>

    <div id="ProductInfo-{{ section.id }}" class="col-span-6 py-[57px]">
      {% assign product_form_id = 'product-form-' | append: section.id %}
      <div class="flex flex-col justify-center items-center gap-y-[13px] w-full max-w-[max(664px,50vw)] mx-auto px-[4.5vw]">
        <h1 class="text-arizona-60 text-center">
          {{ split_product_title[0] }}
        </h1>

        {% if split_product_title[1] != blank  %}
          <h2 class="text-arizona-26 text-center">
            {{ split_product_title[1] }}
          </h2>
        {% endif %}

        <div class="flex flex-row justify-center items-center gap-[26px]">
          <p class="price mb-30 flex items-center gap-5 text-pangram-16">
            {{ product.price | money }}
            {% if product.compare_at_price > product.price %}
              <span class="strike-through opacity-50">{{ product.compare_at_price | money }}</span>
            {% endif %}
          </p>
        </div>

        <div class="flex flex-col justify-start items-start gap-30" x-data="{ activeTab: 0, changeTab(i) { this.activeTab = i} }">
          <div class="no-scrollbar overflow-x-auto w-full">
            <div class="min-w-fit w-full flex flex-row justify-between items-center gap-x-20 pb-5">
              {% if product.metafields.custom.overview != blank %}
                <button @click.prevent="changeTab(0)" class="underline-when-active text-pangram-12" :class="activeTab == 0 ? 'active' : ''">
                  Overview
                </button>
              {% endif %}

              {% if product.metafields.custom.measurements_details != blank %}
                <button @click.prevent="changeTab(1)" class="underline-when-active text-pangram-12" :class="activeTab == 1 ? 'active' : ''">
                  Measurements + Details
                </button>
              {% endif %}

              {% if product.metafields.custom.technical_specifications != blank %}
                <button @click.prevent="changeTab(2)" class="underline-when-active text-pangram-12" :class="activeTab == 2 ? 'active' : ''">
                  Technical Specifications
                </button>
              {% endif %}
            </div>
          </div>

          <div class="px-30">
            {% if product.metafields.custom.overview != blank %}
              <div class="text-oracle-18 [&_p:not(:last-child)]:mb-10 indent-8" x-show="activeTab == 0">
                {{ product.metafields.custom.overview | metafield_tag }}
              </div>
            {% endif %}

            {% if product.metafields.custom.measurements_details != blank %}
              <div class="text-oracle-18 [&_p:not(:last-child)]:mb-10 indent-8"  x-show="activeTab == 1">
                {{ product.metafields.custom.measurements_details | metafield_tag }}
              </div>
            {% endif %}

            {% if product.metafields.custom.technical_specifications != blank %}
              <div class="text-oracle-18 [&_p:not(:last-child)]:mb-10 indent-8"  x-show="activeTab == 2">
                {{ product.metafields.custom.technical_specifications | metafield_tag }}
              </div>
            {% endif %}
          </div>
        </div>


        {% comment %} {% if product.description != blank %}
          <div class="rte text-oracle-18">
            {{ product.description }}
          </div>
        {% endif %} {% endcomment %}

        {% render 'product-form' product: product, product_form_id: product_form_id %}
      </div>

    </div>

    <div class="col-span-6">
      <div class="bg-brown px-[4.5vw] py-30 sticky top-[var(--nav-height)] overflow-clip">
        <div class="product-slider list-unstyled swiper !overflow-x-visible !overflow-y-clip" role="list" data-swiper="product-media">
          <div class="swiper-wrapper">
            {% for media in product.media %}
              <div class="swiper-slide w-[100%_-_4.5vw]" data-media-id="{{ section.id }}-{{ media.id }}">
                {% assign sizes = '(min-width: 769px) 75vw, 100vw' %}
                {{ media | image_url: width: 1000 | image_tag: preload: true, width: media.width, sizes: sizes, widths: '300, 400, 500, 600, 700, 800, 900, 1000, 1200', class: 'w-full aspect-product object-cover' }}
              </div>
            {% endfor %}
          </div>
          <div class="product-slider-pagination swiper-pagination mt-20"></div>
        </div>
      </div>
    </div>
  </div>

</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    function isIE() {
      const ua = window.navigator.userAgent;
      const msie = ua.indexOf('MSIE ');
      const trident = ua.indexOf('Trident/');

      return (msie > 0 || trident > 0);
    }

    if (!isIE()) return;
    const hiddenInput = document.querySelector('#{{ product_form_id }} input[name="id"]');
    const noScriptInputWrapper = document.createElement('div');
    const variantSwitcher = document.querySelector('variant-radios[data-section="{{ section.id }}"]') || document.querySelector('variant-selects[data-section="{{ section.id }}"]');
    noScriptInputWrapper.innerHTML = document.querySelector('.product-form__noscript-wrapper-{{ section.id }}').textContent;
    variantSwitcher.outerHTML = noScriptInputWrapper.outerHTML;

    document.querySelector('#Variants-{{ section.id }}').addEventListener('change', function(event) {
      hiddenInput.value = event.currentTarget.value;
    });
  });
</script>

{% liquid
  if product.selected_or_first_available_variant.featured_media
    assign seo_media = product.selected_or_first_available_variant.featured_media
  else
    assign seo_media = product.featured_media
  endif
%}

<script type="application/ld+json">
  {
    "@context": "http://schema.org/",
    "@type": "Product",
    "name": {{ product.title | json }},
    "url": {{ shop.url | append: product.url | json }},
    {% if seo_media %}
      {% assign media_size = seo_media.preview_image.width | append: 'x' %}
      "image": [
        {{ seo_media | img_url: media_size | prepend: "https:" | json }}
      ],
    {% endif %}
    "description": {{ product.description | strip_html | json }},
    {% if product.selected_or_first_available_variant.sku != blank %}
      "sku": {{ product.selected_or_first_available_variant.sku | json }},
    {% endif %}
    "brand": {
      "@type": "Thing",
      "name": {{ product.vendor | json }}
    },
    "offers": [
      {% for variant in product.variants %}
        {
          "@type" : "Offer",
          {% if variant.sku != blank %}
            "sku": {{ variant.sku | json }},
          {% endif %}
          "availability" : "http://schema.org/{% if variant.available %}InStock{% else %}OutOfStock{% endif %}",
          "price" : {{ variant.price | divided_by: 100.00 | json }},
          "priceCurrency" : {{ cart.currency.iso_code | json }},
          "url" : {{ shop.url | append: variant.url | json }}
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
</script>

{% schema %}
  {
    "name": "Product",
    "tag": "section",
    "class": "product-section",
    "blocks": [

    ],
    "settings": [

    ]
  }
{% endschema %}
